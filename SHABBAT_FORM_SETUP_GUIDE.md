# מדריך התקנת טופס דירה לשבת - Google Forms Integration

## ✅ מה שכבר בוצע בשרת

1. **עדכון כתובת הטופס בשרת** - השרת מכיר את הטופס החדש
2. **מערכת קבלת נתונים מוכנה** - ה-endpoint מוכן לקבל מידע מהטופס
3. **קובץ הסקריפט** - נוצר `GOOGLE_FORMS_APPS_SCRIPT_SHABBAT.js` עם כל הקוד

---

## 📋 מה שנשאר לך לעשות (5 דקות)

### שלב 1: פתיחת הטופס והגדרת אימייל
1. פתח את טופס דירה לשבת ב-Google Forms
2. לחץ על גלגל השיניים ⚙️ (Settings) למעלה
3. וודא ש-**"Collect email addresses"** מסומן ✅
4. בחר **"Verified"** (או "מאומתות")
5. שמור

### שלב 2: העתקת הסקריפט
1. בטופס, לחץ על שלוש הנקודות למעלה ⋮
2. בחר **Extensions → Apps Script**
3. יפתח עורך הקוד של Google
4. **מחק את כל הקוד הקיים**
5. פתח את הקובץ `GOOGLE_FORMS_APPS_SCRIPT_SHABBAT.js` שנוצר
6. **העתק את כל הקוד** (Ctrl+A → Ctrl+C)
7. הדבק בעורך של Google Apps Script (Ctrl+V)
8. שמור (Ctrl+S)
9. תן שם לפרויקט: "Shabbat Form Webhook Integration"

### שלב 3: יצירת Trigger (טריגר אוטומטי)
1. בעורך Google Apps Script, לחץ על סימן השעון ⏰ בתפריט השמאלי (**Triggers**)
2. לחץ **"+ Add Trigger"** (כפתור כחול בפינה)
3. בחר את ההגדרות הבאות:
   - **Choose which function to run:** `onFormSubmit`
   - **Choose which deployment should run:** `Head`
   - **Select event source:** `From form`
   - **Select event type:** `On form submit`
4. לחץ **Save**
5. אם מבקש הרשאות - אשר (Review permissions → בחר את החשבון → Advanced → Go to... → Allow)

---

## 🧪 בדיקה

1. **מלא את הטופס** (בדיקה אמיתית)
2. **המתן 5-10 שניות**
3. **היכנס לאתר** → התחבר כמנהל
4. לך ל**"ניהול מודעות"** → **"ממתינות לאישור"**
5. **המודעה שלך צריכה להופיע שם!** ✨

אם יש בעיה:
- פתח את Google Apps Script
- כנס ל-**Executions** (⚡ בתפריט שמאל)
- ראה אם יש שגיאות

---

## 🔍 מה ייחודי בטופס דירה לשבת?

שדות נוספים שלא קיימים במכירה/השכרה:

### שדות ייחודיים:
- **אירוח בתשלום** (`isPaid`) - כן/לא
- **פרשה** (`parasha`) - שבת פרשת... (למשל: "ויקרא")
- **מטרת האירוח** (`purpose`) - אירוח מלא / לינה בלבד
- **מחיר מבוקש** (`priceRequested`) - רק אם אירוח בתשלום = כן

### מאפיינים נוספים:
- **שעון שבת** (`shabbosClock`) - במאפיינים
- **לינה בלבד** (`sleepingOnly`) - במאפיינים

### התנהגות חכמה:
- אם "אירוח בתשלום" = לא → השדה `price` לא יישלח
- אם "אירוח בתשלום" = כן → השדה `priceRequested` יוסב ל-`price`
- הכותרת האוטומטית תכלול את הפרשה: "דירה 5 חדרים לשבת פרשת ויקרא בירושלים"

---

## ⚙️ מיפוי שדות

```javascript
// שדות ייחודיים לדירה לשבת (בנוסף לשדות הרגילים)
isPaid: 'אירוח בתשלום'           // כן/לא
parasha: 'פרשה'                   // טקסט חופשי
purpose: 'מטרת האירוח'            // רשימה: אירוח מלא / לינה בלבד
priceRequested: 'מחיר מבוקש'      // מספר (אם בתשלום)
```

המערכת מזהה:
- **"אירוח מלא"** → `purpose: 'HOSTING'`
- **"לינה בלבד"** → `purpose: 'SLEEPING_ONLY'`

---

## ⚠️ נקודות חשובות

1. **שמות השדות בטופס** - אם שמות השאלות בטופס שונים, עדכן את `FIELD_MAPPING` בקוד
2. **מחיר מותנה** - המערכת תשלח מחיר רק אם "אירוח בתשלום" = כן
3. **פרשה** - הקפד על איות נכון (למשל: "בראשית", "נח", "לך לך")
4. **מאפיינים** - כולל "שעון שבת" ו"לינה בלבד" בנוסף למאפיינים הרגילים
5. **כל שינוי בקוד** - חייב לשמור מחדש (Ctrl+S) ב-Apps Script

---

## 📊 מצב הטפסים

| טופס | URL בשרת | Apps Script | Trigger | סטטוס |
|------|----------|-------------|---------|--------|
| **פרסום מכירה** | ✅ | ✅ | ✅ | 🟢 עובד |
| **פרסום השכרה** | ✅ | ✅ | ⏳ | 🟡 צריך להתקין |
| **פרסום שבת** | ✅ | ✅ | ⏳ | 🟡 צריך להתקין |
| מסחרי | ❌ | ❌ | ❌ | 🔴 לא מוכן |
| משותף | ❌ | ❌ | ❌ | 🔴 לא מוכן |
| מבוקש קניה | ❌ | ❌ | ❌ | 🔴 לא מוכן |
| מבוקש השכרה | ❌ | ❌ | ❌ | 🔴 לא מוכן |
| מבוקש שבת | ❌ | ❌ | ❌ | 🔴 לא מוכן |

---

## 🚀 הצעדים הבאים

לאחר שתבדוק שטופס שבת עובד, נוכל להמשיך ל:
1. **מסחרי** - שדות שונים (שטח מסחרי, סוג עסק)
2. **משותף** - שדות של בעלות משותפת
3. **מבוקש...** - שדות שונים, תהליך דומה

כל טופס לוקח **5 דקות להתקנה** אחרי שהקוד מוכן! 💪
