# מדריך ייבוא נכסים מקובץ XLSX

## סקירה כללית

תכונה זו מאפשרת ייבוא מודעות נכסים בצורה מהירה מקובץ XLSX. המערכת תומכת במספר סוגי מודעות שונים עם שדות ספציפיים לכל אחד.

## גישה לתכונה

**Admin Panel → ייבוא ונתונים חיצוניים → ייבוא נכסים מקובץ**

## סוגי מודעות נתמכים

### 1. דירות למכירה - מודעה רגילה
**קטגוריה:** דירות למכירה  
**סוג מודעה:** מודעה רגילה (מוכר)

**שדות חובה:**
- תיווך (כן/לא)
- עיר
- רחוב
- מספר בית
- סוג הנכס (דירה / בית / וילה / פנטהאוז / דופלקס)
- מספר חדרים
- שטח במר
- מצב הנכס (חדש / משופץ / דורש שיפוץ)
- קומה
- מספר מרפסות
- ריהוט (מלא / חלקי / ללא)
- תאריך כניסה (DD/MM/YYYY)
- מחיר
- תיאור הנכס
- טלפון

**שדות אופציונליים:**
- שם (איש קשר)
- ארנונה
- ועד בית
- חניה (כן/לא)
- מחסן (כן/לא)
- ממד (כן/לא)
- מרפסת סוכה (כן/לא)
- מעלית (כן/לא)
- נוף (כן/לא)
- יחידת הורים (כן/לא)
- יחידת דיור (כן/לא)
- חצר (כן/לא)
- מיזוג (כן/לא)
- אופציה (כן/לא)
- תמונה 1 (URL)
- תמונה 2 (URL)
- תמונה 3 (URL)

---

### 2. דירות למכירה - דרושים
**קטגוריה:** דירות למכירה  
**סוג מודעה:** דרושים (קונה)

**שדות חובה:**
- תיווך (כן/לא)
- רחוב / אזור מבוקש (טקסט חופשי - לדוגמה: "רחוב הרצל או סביבה")
- סוג הנכס
- מספר חדרים
- שם (איש קשר)
- טלפון

**שדות אופציונליים:**
- שטח במר
- קומה
- מרפסות
- מצב הנכס
- ריהוט
- מחיר
- ארנונה
- ועד בית
- תאריך כניסה
- חניה
- מחסן
- נוף
- מיזוג
- מרפסת סוכה
- יחידת הורים
- ממד
- חצר
- יחידת דיור
- מעלית
- אופציה

**הערה:** מודעת "דרושים" לא דורשת כתובת מדויקת, רק אזור מבוקש.

---

### 3. דירות להשכרה - מודעה רגילה
**קטגוריה:** דירות להשכרה  
**סוג מודעה:** מודעה רגילה (משכיר)

**שדות חובה:**
- תיווך (כן/לא)
- עיר
- רחוב
- מספר בית
- סוג הנכס
- מספר חדרים
- שטח במר
- מצב הנכס
- קומה
- מספר מרפסות
- ריהוט (מלא / חלקי / ללא)
- תאריך כניסה
- מחיר (דמי שכירות חודשיים)
- תיאור הנכס
- שם
- טלפון

**שדות אופציונליים:**
- ארנונה
- ועד בית
- חניה
- מחסן
- ממד
- מרפסת סוכה
- מעלית
- נוף
- יחידת הורים
- יחידת דיור
- חצר
- מיזוג
- תמונה 1, 2, 3

**הערה:** אין שדה "אופציה" במודעות השכרה.

---

### 4. דירות להשכרה - דרושים
**קטגוריה:** דירות להשכרה  
**סוג מודעה:** דרושים (שוכר)

**שדות חובה:**
- תיווך (כן/לא)
- רחוב / אזור מבוקש
- סוג הנכס
- מספר חדרים
- שם
- טלפון

**שדות אופציונליים:**
- שטח במר
- קומה
- מרפסות
- מצב הנכס
- ריהוט
- מחיר
- ארנונה
- ועד בית
- תאריך כניסה
- חניה
- מחסן
- נוף
- מיזוג
- מרפסת סוכה
- יחידת הורים
- ממד
- חצר
- יחידת דיור
- מעלית

**הערה:** אין "אופציה" במודעות השכרה.

---

### 5. דירות לשבת - מודעה רגילה
**קטגוריה:** דירות לשבת  
**סוג מודעה:** מודעה רגילה (מציע אירוח)

**שדות חובה:**
- רחוב / אזור מבוקש
- בתשלום (כן/לא)
- פרשה (למשל: "בראשית", "נח", "לך לך")
- סוג הנכס
- מספר חדרים
- מטרה (אירוח / לינה בלבד)
- טלפון

**שדות אופציונליים:**
- שם
- קומה
- מספר מרפסות
- פלטה (כן/לא)
- מיחם (כן/לא)
- נוף
- מצעים
- מיזוג
- מרפסת
- בריכה
- חצר
- משחקי ילדים
- מיטת תינוק
- יחידת הורים
- לינה בלבד (כן/לא)
- מחיר

**הערה:** דירות לשבת לא תומכות בהעלאת תמונות מקובץ.

---

### 6. דירות לשבת - דרושים
**קטגוריה:** דירות לשבת  
**סוג מודעה:** דרושים (מחפש אירוח)

**שדות חובה:**
- רחוב / אזור מבוקש
- בתשלום (כן/לא)
- פרשה
- סוג הנכס
- מספר חדרים
- טלפון

**שדות אופציונליים:**
- שם
- מטרה (אירוח / לינה בלבד)
- קומה
- מספר מרפסות
- פלטה
- מיחם
- נוף
- מצעים
- מיזוג
- מרפסת
- בריכה
- חצר
- משחקי ילדים
- מיטת תינוק
- יחידת הורים
- לינה בלבד
- מחיר

---

### 7. יחידות דיור
**קטגוריה:** יחידות דיור  
**סוג מודעה:** מודעה רגילה (אין בחירה)

זהה לדירות להשכרה - מודעה רגילה (ראה סעיף 3).

---

### 8. נדל"ן מסחרי - מודעה רגילה
**קטגוריה:** נדל"ן מסחרי  
**סוג מודעה:** מודעה רגילה

**שדות חובה:**
- תיווך (כן/לא)
- עיר
- רחוב
- מספר בית
- סוג הנכס (חנות / משרד / מחסן / אולם)
- שטח במר
- מחיר
- תיאור הנכס
- טלפון

**שדות אופציונליים:**
- שם
- קומה
- מצב הנכס
- תאריך כניסה
- חניה
- מעלית
- מיזוג
- תמונה 1, 2, 3

---

### 9. נדל"ן מסחרי - דרושים
**קטגוריה:** נדל"ן מסחרי  
**סוג מודעה:** דרושים

**שדות חובה:**
- תיווך (כן/לא)
- רחוב / אזור מבוקש
- סוג הנכס (חנות / משרד / מחסן / אולם)
- טלפון

**שדות אופציונליים:**
- שם
- שטח במר
- קומה
- מצב הנכס
- מחיר
- תאריך כניסה
- חניה
- מעלית
- מיזוג

---

## הוראות שימוש

### 1. בחירת קטגוריה וסוג מודעה
1. היכנס לדף "ייבוא נכסים מקובץ"
2. בחר קטגוריה מהרשימה הנפתחת
3. אם הקטגוריה תומכת בבחירת סוג מודעה (דירות למכירה, דירות להשכרה, דירות לשבת, נדל"ן מסחרי), תופיע רשימה נוספת:
   - **מודעה רגילה** - למי שיש נכס ורוצה למכור/להשכיר/להציע
   - **דרושים** - למי שמחפש נכס לקנות/לשכור
   
   **הערה:** קטגוריית "יחידות דיור" תמיד מייבאת כמודעה רגילה (אין בחירת סוג מודעה).

### 2. הורדת תבנית
1. לחץ על כפתור "הורד תבנית XLSX לקטגוריה זו"
2. התבנית תכיל שורת דוגמה עם כל השדות הנדרשים
3. התבנית משתנה אוטומטית לפי הקטגוריה וסוג המודעה שנבחרו

### 3. מילוי הקובץ
- השאר את שורת הכותרות (שורה 1) כפי שהיא
- מחק את שורת הדוגמה והוסף את הנתונים שלך
- ודא שכל השדות החובה מולאו
- השתמש ב"כן"/"לא" לשדות בוליאניים (או yes/no באנגלית)
- תאריכים בפורמט DD/MM/YYYY (לדוגמה: 25/12/2026)
- תמונות: הכנס כתובת URL מלאה המתחילה ב-http:// או https://

### 4. העלאה ותצוגה מקדימה
1. בחר את הקובץ שמילאת
2. בחר סטטוס ראשוני:
   - **ממתין לאישור** (מומלץ) - מודעות ממתינות לאישור ידני
   - **טיוטה** - מודעות נשמרות כטיוטה
3. לחץ "העלה וצפה בתצוגה מקדימה"
4. המערכת תציג טבלה עם כל השורות:
   - **תקין** - השורה תיובא
   - **שגוי** - יש שגיאות (יוצג פירוט)
   - **כפול** - שורה כפולה בקובץ

### 5. ייבוא סופי
1. בדוק את התצוגה המקדימה
2. לחץ "ייבא נכסים תקינים"
3. המערכת תייבא רק שורות תקינות
4. תקבל הודעה עם מספר המודעות שנוצרו

---

## כללי וולידציה

### שדות חובה
- **ריהוט:** רק "מלא", "חלקי", או "ללא"
- **מטרה (דירה לשבת):** רק "אירוח" או "לינה בלבד"
- **שדות בוליאניים:** "כן"/"לא" או "yes"/"no" או "true"/"false" או "1"/"0"
- **קומה:** מספר שלם או "קרקע"
- **מספר חדרים:** מספר (ניתן עם חצי חדר, לדוגמה: 4.5)

### בדיקת כפילויות
- **דירות רגילות (למכירה/להשכרה):** נבדק לפי עיר + רחוב + מספר בית
- **דרושים ודירות שבת:** אין בדיקת כפילויות

### טיפול בשגיאות
- שדות חובה חסרים → השורה לא תיובא
- פורמט שגוי (מחיר, תאריך, וכו') → השורה לא תיובא
- ערכים לא תקינים (ריהוט, מטרה) → השורה לא תיובא

---

## דוגמאות

### דוגמה 1: דירה למכירה - מודעה רגילה
```
תיווך: כן
עיר: ירושלים
רחוב: הרצל
מספר בית: 15
סוג הנכס: דירה
מספר חדרים: 4.5
שטח במר: 100
מצב הנכס: משופץ
קומה: 2
מספר מרפסות: 1
ריהוט: חלקי
תאריך כניסה: 01/06/2026
מחיר: 1800000
ארנונה: 500
ועד בית: 300
חניה: כן
מחסן: לא
ממד: כן
מעלית: כן
תיאור הנכס: דירת 4.5 חדרים מרווחת ומשופצת, קומה 2 עם מעלית
שם: ישראל ישראלי
טלפון: 050-1234567
```

### דוגמה 2: דרושים - דירה לקניה
```
תיווך: לא
רחוב / אזור מבוקש: רחוב הרצל או סביבה
סוג הנכס: דירה
מספר חדרים: 4
מחיר: 1500000
שם: מוישה כהן
טלפון: 052-9876543
```

### דוגמה 3: דירה לשבת
```
רחוב / אזור מבוקש: גילה
בתשלום: לא
פרשה: בראשית
סוג הנכס: דירה
מספר חדרים: 5
מטרה: אירוח
קומה: 1
פלטה: כן
מיחם: כן
מצעים: כן
משחקי ילדים: כן
שם: אברהם אברהמי
טלפון: 02-6543210
```

---

## הערות חשובות

1. **ייבוא ערים ורחובות לא נפגע** - הייבוא הקיים של ערים ורחובות ממשיך לעבוד בדיוק כמו קודם.

2. **סטטוס מודעות** - כל המודעות המיובאות מתחילות בסטטוס ממתין לאישור או טיוטה (לבחירתך), לעולם לא מפורסמות אוטומטית.

3. **משתמש** - כל המודעות נוצרות תחת חשבון האדמין שמבצע את הייבוא.

4. **תמונות** - ניתן להוסיף עד 3 תמונות (חוץ מדירות שבת) באמצעות URLs מלאים.

5. **גודל קובץ** - מקסימום 10MB.

6. **לוג ייבוא** - כל ייבוא נשמר בלוג עם פרטי הצלחה/כישלון.

---

## פתרון בעיות

### "חסרות עמודות חובה"
→ ודא שכל השדות החובה קיימים בקובץ עם השמות המדויקים כפי שבתבנית.

### "מספר חדרים לא תקין"
→ השתמש במספרים בלבד (לדוגמה: 4 או 4.5), לא טקסט.

### "ריהוט חייב להיות: מלא / חלקי / ללא"
→ הקלד בדיוק אחת מהאפשרויות הללו (עברית).

### "תאריך לא תקין"
→ השתמש בפורמט DD/MM/YYYY (לדוגמה: 01/06/2026).

### "ערך לא תקין - יש להזין כן או לא"
→ בשדות בוליאניים השתמש ב"כן" או "לא" (או yes/no באנגלית).

---

## קבצים טכניים

### Backend
- `server/src/modules/admin/import.routes.ts`
  - getSchemaForCategory() - 5 schemas שונים לפי ad type
  - Parsers: requiredString, parseRooms, parseFurniture, parsePurpose, parseUrl, וכו'
  - buildCustomFields() - בונה customFields לפי סוג המודעה
  - buildTitle() - יוצר כותרת אוטומטית
  
### Frontend
- `client/src/pages/admin/ImportPropertiesFromFile.tsx`
  - getTemplateForCategory() - יוצר תבניות XLSX לפי סוג מודעה
  - Dropdown selector לבחירת adType
  - handlePreview() - מציג תצוגה מקדימה
  - handleCommit() - מבצע ייבוא סופי

---

**גרסה:** 1.0  
**עדכון אחרון:** 2026-01-10
