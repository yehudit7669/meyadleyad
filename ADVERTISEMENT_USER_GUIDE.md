# 📰 מערכת פרסומות ללוח מודעות עיתון - מדריך שימוש

## 🎯 מה ממומש

### תכונות עיקריות
✅ **הוספת פרסומות (תמונות) ללוח מודעות**
- מנהל בלבד יכול להוסיף פרסומות
- תמיכה ב-4 גדלים: 1×1, 2×1, 3×1, 2×2 (במונחי קוביות)
- 2 אפשרויות מיקום:
  1. **לפני נכס מסוים** - הפרסומת תמוקם לפני נכס שנבחר
  2. **מיקום מדויק** - עמוד/שורה/עמודה ספציפית

✅ **גריד קבוע ויציב**
- תמיד 3 קוביות לרוחב (חוק קשיח)
- נכסים "נדחקים" אוטומטית כדי לפנות מקום לפרסומות
- פרסומות לא יכולות לחצות עמוד (אם אין מקום → עוברת לעמוד הבא)

✅ **ניהול מלא**
- העלאת תמונה
- עריכת פרסומת (תמונה, גודל, מיקום)
- הסרת פרסומת עם כפתור ✖ (בעורך או במודאל)

✅ **אלגוריתם Layout חכם**
- חישוב אוטומטי של פריסה
- מניעת התנגשויות
- החזרת שגיאות אם אין מקום

---

## 🚀 איך להשתמש

### שלב 1: פתיחת העורך
1. היכנסו ל**לוח מודעות** של קטגוריה+עיר מסוימת
2. לחצו על **עריכה**

### שלב 2: הוספת פרסומת
1. בפינה השמאלית התחתונה, לחצו על הכפתור הצהוב **"פרסומות"**
2. במודאל שנפתח, לחצו **"הוסף פרסומת חדשה"**
3. העלו תמונה (PNG/JPG)
4. בחרו **גודל**:
   - `1×1` - קוביה אחת
   - `2×1` - 2 קוביות לרוחב
   - `3×1` - שורה מלאה (3 קוביות)
   - `2×2` - ריבוע של 4 קוביות
5. בחרו **סוג מיקום**:
   - **לפני נכס מסוים**: בחרו נכס מהרשימה
   - **מיקום מדויק**: הזינו עמוד (1+), שורה (1-7), עמודה (1-3)
6. לחצו **"הוסף"**

### שלב 3: תצוגה בעורך
- הפרסומות מוצגות בסוף הגריד בקוביות צהובות מיוחדות
- יש תג "פרסומת" וגודל הפרסומת
- כפתור ✖ למחיקה מהירה (מופיע במעבר עכבר)

### שלב 4: עריכה/מחיקה
- לעריכה: לחצו על **עריכה** ליד הפרסומת במודאל
- למחיקה: לחצו על **מחק** או על ✖ בעורך

---

## ⚙️ כללים טכניים

### גריד קבוע
- **3 עמודות בדיוק** בכל עמוד
- **7 שורות** לעמוד (21 קוביות)
- פרסומות תופסות מספר תאים לפי הגודל שלהן

### מיקום פרסומות
#### beforeIndex (לפני נכס)
- הפרסומת תשמר את המיקום היחסי שלה ביחס לנכס
- אם משנים סדר נכסים, הפרסומת נשארת לפני אותו נכס
- אם אין מקום בעמוד → עוברת לעמוד הבא

#### pagePosition (מיקום מדויק)
- הפרסומת תמוקם **בדיוק** במקום שנבחר
- אם התא תפוס → תוצג שגיאה
- שימושי לפרסומות קבועות (כמו כותרת עמוד)

### התנהגות עם drag & drop
- גרירת נכסים ממשיכה לעבוד **ללא שינוי**
- פרסומות **לא ניתנות לגרירה** (רק עריכה דרך המודאל)
- הסדר של הנכסים משפיע רק על beforeIndex ads

---

## 📋 דוגמאות שימוש

### דוגמה 1: פרסומת בראש העמוד
```
סוג מיקום: מיקום מדויק
עמוד: 1
שורה: 1
עמודה: 1
גודל: 3×1 (שורה מלאה)
```
→ פרסומת רחבה בראש העמוד הראשון

### דוגמה 2: פרסומת לפני נכס
```
סוג מיקום: לפני נכס מסוים
נכס: דירה ברח' הרצל 12
גודל: 2×2 (ריבוע)
```
→ פרסומת תמיד תופיע לפני הדירה הזו, גם אם משנים סדר

### דוגמה 3: פרסומת קטנה באמצע
```
סוג מיקום: מיקום מדויק
עמוד: 2
שורה: 4
עמודה: 2
גודל: 1×1
```
→ פרסומת קטנה במרכז העמוד השני

---

## 🛠️ פתרון בעיות

### בעיה: "אין מקום בעמוד הזה"
**פתרון**: 
- בדקו שיש מספיק תאים פנויים
- לפרסומת 2×2 צריך 4 תאים רצופים
- נסו עמוד אחר או מיקום אחר

### בעיה: הפרסומת לא מופיעה
**פתרון**:
- רעננו את העמוד (F5)
- וודאו שהפרסומת נוספה בהצלחה (אמור להיות הודעה ירוקה)
- בדקו שהתמונה הועלתה

### בעיה: drag & drop לא עובד
**פתרון**:
- אל תנסו לגרור את הפרסומות, רק את הנכסים
- אם drag של נכסים לא עובד → דווחו באג

---

## 🔒 הרשאות
- **רק מנהלים** יכולים להוסיף/לערוך/למחוק פרסומות
- משתמשים רגילים לא רואים את הכפתור "פרסומות"

---

## 📊 Audit Log
כל פעולה נרשמת:
- `NEWSPAPER_SHEET_AD_ADDED` - פרסומת נוספה
- `NEWSPAPER_SHEET_AD_UPDATED` - פרסומת עודכנה
- `NEWSPAPER_SHEET_AD_REMOVED` - פרסומת הוסרה

---

## 🎨 עיצוב
- פרסומות מוצגות ברקע צהוב (`#fff3cd`) עם מסגרת מקווקוות צהובה
- תג "פרסומת" בפינה הימנית העליונה
- כפתור ✖ אדום בפינה השמאלית העליונה (במעבר עכבר)

---

## 🚧 מה עוד לא ממומש (אופציונלי להמשך)

### PDF עם פרסומות
- כרגע הפרסומות **לא מופיעות ב-PDF** (רק בעורך)
- כדי להוסיף ל-PDF, צריך לעדכן את `generateHTML` ב-`newspaper-sheet-pdf.service.ts`
- להשתמש באלגוריתם `calculateNewspaperLayout` ולרנדר את הפרסומות כ-`<img>` בגריד

### לוח כללי
- כשה-PDF של כל sheet יכלול פרסומות → הלוח הכללי אוטומטית יכלול אותן
- אין צורך בשינוי נוסף

---

## 📅 תאריך עדכון
9 בפברואר 2026

---

**הערה למפתח**: 
הקוד מוכן ויציב. אם רוצים להוסיף PDF עם פרסומות, יש צורך בעבודת פיתוח נוספת של כ-2-3 שעות (עדכון HTML generation).
